<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">文章详情 | 郑啸</title>
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="../style.css" as="style">
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//raw.githubusercontent.com">
    
    <!-- 关键CSS内联 -->
    <style>
        /* 关键样式内联以避免FOUC */
        .font-inter { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .bg-light { background-color: #F9FAFB; }
        .text-dark { color: #1D2939; }
        .text-primary { color: #165DFF; }
        .bg-primary { background-color: #165DFF; }
        .hidden { display: none; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .loading-skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #165DFF;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* 文章内容样式 */
        .prose { max-width: none; }
        .prose h1 { font-size: 2rem; font-weight: bold; margin: 1.5rem 0 1rem 0; color: #1D2939; }
        .prose h2 { font-size: 1.5rem; font-weight: bold; margin: 1.25rem 0 0.75rem 0; color: #1D2939; }
        .prose h3 { font-size: 1.25rem; font-weight: bold; margin: 1rem 0 0.5rem 0; color: #1D2939; }
        .prose p { margin: 1rem 0; line-height: 1.6; color: #374151; }
        .prose code { background: #f3f4f6; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.875rem; }
        .prose pre { background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 1rem 0; }
        .prose pre code { background: none; padding: 0; }
        .prose blockquote { border-left: 4px solid #165DFF; padding-left: 1rem; margin: 1rem 0; font-style: italic; color: #6b7280; }
        .prose ul, .prose ol { margin: 1rem 0; padding-left: 1.5rem; }
        .prose li { margin: 0.5rem 0; }
        .prose a { color: #165DFF; text-decoration: underline; }
        .prose a:hover { color: #0E2E91; }
    </style>
    
    <!-- 字体加载 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 样式表 -->
    <link href="../style.css" rel="stylesheet">
    
    <!-- 异步加载非关键CSS -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"></noscript>
    
    <!-- 延迟加载Tailwind CSS -->
    <script>
        // 优化的Tailwind配置
        window.tailwindConfig = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#0E2E91',
                        accent: '#36BFFA',
                        dark: '#1D2939',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        };
        
        // 延迟加载Tailwind
        function loadTailwind() {
            const script = document.createElement('script');
            script.src = 'https://cdn.tailwindcss.com';
            script.async = true;
            document.head.appendChild(script);
        }
        
        // 页面关键内容加载后再加载Tailwind
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadTailwind);
        } else {
            loadTailwind();
        }
    </script>
</head>
<body class="font-inter bg-light text-dark antialiased overflow-x-hidden">
    <!-- 加载指示器 -->
    <div id="loading-indicator" class="fixed top-0 left-0 w-full h-1 bg-primary z-50 transform -translate-x-full transition-transform duration-300"></div>
    
    <!-- 导航栏 -->
    <header id="navbar" class="fixed w-full top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <a href="../index.html" class="text-2xl font-bold text-primary flex items-center">
                <span class="mr-2"><i class="fa-solid fa-rocket"></i></span>
                <span>郑啸</span>
            </a>
            
            <!-- 桌面导航 -->
            <nav class="hidden md:flex items-center space-x-8">
                <a href="../index.html" class="text-dark hover:text-primary transition-colors font-medium">首页</a>
                <a href="../index.html#about" class="text-dark hover:text-primary transition-colors font-medium">关于我</a>
                <a href="../index.html#internship" class="text-dark hover:text-primary transition-colors font-medium">实习经历</a>
                <a href="../index.html#projects" class="text-dark hover:text-primary transition-colors font-medium">项目经历</a>
                <a href="../index.html#skills" class="text-dark hover:text-primary transition-colors font-medium">技能</a>
                <a href="../blog.html" class="text-primary font-medium">博客</a>
                <a href="../index.html#contact" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-lg transition-all hover:shadow-lg">联系我</a>
            </nav>
            
            <!-- 移动端汉堡菜单 -->
            <button id="menu-toggle" class="md:hidden text-dark focus:outline-none">
                <i class="fa-solid fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg absolute w-full">
            <div class="container mx-auto px-4 py-3 flex flex-col space-y-4">
                <a href="../index.html" class="text-dark hover:text-primary transition-colors py-2 font-medium">首页</a>
                <a href="../index.html#about" class="text-dark hover:text-primary transition-colors py-2 font-medium">关于我</a>
                <a href="../index.html#internship" class="text-dark hover:text-primary transition-colors py-2 font-medium">实习经历</a>
                <a href="../index.html#projects" class="text-dark hover:text-primary transition-colors py-2 font-medium">项目经历</a>
                <a href="../index.html#skills" class="text-dark hover:text-primary transition-colors py-2 font-medium">技能</a>
                <a href="../blog.html" class="text-primary font-medium">博客</a>
                <a href="../index.html#contact" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-lg transition-all hover:shadow-lg text-center">联系我</a>
            </div>
        </div>
    </header>

    <main class="pt-20">
        <!-- 文章内容区域 -->
        <article class="py-16 bg-white">
            <div class="container mx-auto px-4 max-w-4xl">
                <!-- 返回按钮 -->
                <div class="mb-8">
                    <a href="../blog.html" class="inline-flex items-center text-primary hover:text-secondary transition-colors">
                        <i class="fa-solid fa-arrow-left mr-2"></i>
                        返回博客列表
                    </a>
                </div>
                
                <!-- 文章头部 -->
                <header id="article-header" class="mb-8">
                    <!-- 加载状态 -->
                    <div id="header-loading" class="space-y-4">
                        <div class="loading-skeleton h-12 w-3/4"></div>
                        <div class="loading-skeleton h-4 w-1/2"></div>
                        <div class="loading-skeleton h-64 w-full"></div>
                    </div>
                    
                    <!-- 实际内容 -->
                    <div id="header-content" class="hidden">
                        <h1 id="article-title" class="text-4xl font-bold mb-4"></h1>
                        <div class="flex items-center text-sm text-gray-500 mb-6">
                            <span id="article-date"></span>
                            <span class="mx-2">•</span>
                            <span id="article-category" class="text-primary"></span>
                            <span class="mx-2">•</span>
                            <span id="article-reading-time"></span>
                        </div>
                        <img id="article-cover" src="" alt="" class="w-full h-64 object-cover rounded-lg mb-6 hidden">
                        <div id="article-tags" class="flex flex-wrap gap-2 mb-6"></div>
                    </div>
                </header>
                
                <!-- 文章内容 -->
                <div id="article-content" class="prose lg:prose-lg">
                    <!-- 加载状态 -->
                    <div id="content-loading" class="space-y-4">
                        <div class="loading-skeleton h-4 w-full"></div>
                        <div class="loading-skeleton h-4 w-5/6"></div>
                        <div class="loading-skeleton h-4 w-4/5"></div>
                        <div class="loading-skeleton h-32 w-full"></div>
                        <div class="loading-skeleton h-4 w-full"></div>
                        <div class="loading-skeleton h-4 w-3/4"></div>
                    </div>
                    
                    <!-- 实际内容将通过JavaScript插入这里 -->
                    <div id="content-body" class="hidden"></div>
                </div>
                
                <!-- 错误状态 -->
                <div id="error-state" class="hidden text-center py-12">
                    <div class="text-5xl text-gray-300 mb-4"><i class="fa-solid fa-exclamation-triangle"></i></div>
                    <h3 class="text-xl font-bold text-gray-500 mb-2">文章加载失败</h3>
                    <p class="text-gray-400 mb-4">无法从任何数据源加载文章内容</p>
                    <button onclick="retryLoadArticle()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        重新加载
                    </button>
                </div>
            </div>
        </article>
    </main>
    
    <!-- 页脚 -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <a href="../index.html" class="text-2xl font-bold text-white flex items-center">
                        <span class="mr-2"><i class="fa-solid fa-rocket"></i></span>
                        <span>郑啸</span>
                    </a>
                    <p class="mt-2 text-gray-400">算法工程师 & 后端开发工程师</p>
                </div>
                
                <div class="flex space-x-6">
                    <a href="https://github.com/Shawnzheng011019" class="text-white hover:text-primary transition-colors text-xl">
                        <i class="fa-brands fa-github"></i>
                    </a>
                    <a href="mailto:Shawnzheng2001@outlook.com" class="text-white hover:text-primary transition-colors text-xl">
                        <i class="fa-solid fa-envelope"></i>
                    </a>
                    <a href="tel:16678627572" class="text-white hover:text-primary transition-colors text-xl">
                        <i class="fa-solid fa-phone"></i>
                    </a>
                </div>
            </div>
            
            <hr class="border-gray-800 my-8">
            
            <div class="text-center text-gray-500">
                <p>&copy; 2024 郑啸. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="js/blog.js"></script>
    <script>
        // 文章详情页面专用脚本
        let currentArticle = null;
        
        // 从URL获取文章ID
        function getArticleIdFromURL() {
            const pathname = window.location.pathname;
            
            // 如果URL格式是 /文章名.md，直接提取文章名
            if (pathname.endsWith('.md')) {
                return pathname.substring(1, pathname.length - 3); // 去掉开头的/和结尾的.md
            }
            
            // 兼容旧的 /blog/文章ID 格式
            const pathParts = pathname.split('/');
            return pathParts[pathParts.length - 1] || pathParts[pathParts.length - 2];
        }
        
        // 加载文章详情
        async function loadArticleDetail() {
            const articleId = getArticleIdFromURL();
            if (!articleId) {
                showErrorState('未找到文章ID');
                return;
            }
            
            try {
                showLoadingState();
                
                // 获取最佳数据源
                const source = await getBestDataSource();
                
                // 获取文章列表以找到对应文章
                const postsData = await fetchPostsData(source);
                const article = postsData.find(post => post.id === articleId);
                
                if (!article) {
                    showErrorState('未找到指定文章');
                    return;
                }
                
                currentArticle = article;
                
                // 获取文章内容
                const content = await fetchArticleContent(article);
                
                // 显示文章
                displayArticle(article, content);
                hideLoadingState();
                
            } catch (error) {
                console.error('加载文章失败:', error);
                showErrorState('文章加载失败：' + error.message);
            }
        }
        
        // 显示文章内容
        function displayArticle(article, content) {
            // 更新页面标题
            document.getElementById('page-title').textContent = `${article.title} | 郑啸`;
            
            // 更新文章头部
            document.getElementById('article-title').textContent = article.title;
            document.getElementById('article-date').textContent = formatDate(article.date);
            document.getElementById('article-category').textContent = article.category;
            document.getElementById('article-reading-time').textContent = article.readingTime || '预计阅读时间未知';
            
            // 设置封面图片
            const coverImg = document.getElementById('article-cover');
            if (article.cover) {
                coverImg.src = article.cover;
                coverImg.alt = article.title;
                coverImg.classList.remove('hidden');
            }
            
            // 设置标签
            const tagsContainer = document.getElementById('article-tags');
            if (article.tags && article.tags.length > 0) {
                tagsContainer.innerHTML = article.tags.map(tag => 
                    `<span class="px-2 py-1 bg-primary/10 text-primary text-sm rounded">${tag}</span>`
                ).join('');
            }
            
            // 设置文章内容
            const contentBody = document.getElementById('content-body');
            contentBody.innerHTML = parseMarkdownToHTML(content);
            contentBody.classList.remove('hidden');
            
            // 显示头部内容
            document.getElementById('header-content').classList.remove('hidden');
        }
        
        // 显示加载状态
        function showLoadingState() {
            document.getElementById('header-loading').style.display = 'block';
            document.getElementById('content-loading').style.display = 'block';
            document.getElementById('header-content').classList.add('hidden');
            document.getElementById('content-body').classList.add('hidden');
            document.getElementById('error-state').classList.add('hidden');
        }
        
        // 隐藏加载状态
        function hideLoadingState() {
            document.getElementById('header-loading').style.display = 'none';
            document.getElementById('content-loading').style.display = 'none';
        }
        
        // 显示错误状态
        function showErrorState(message) {
            hideLoadingState();
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('error-state').querySelector('p').textContent = message;
        }
        
        // 重试加载文章
        window.retryLoadArticle = function() {
            // 清除缓存的数据源偏好
            localStorage.removeItem('preferred_data_source');
            loadArticleDetail();
        };
        
        // 页面加载完成后初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initDOMCache();
                loadArticleDetail();
            });
        } else {
            initDOMCache();
            loadArticleDetail();
        }
        
        // 导航栏滚动效果
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('bg-white/95', 'backdrop-blur-sm', 'shadow-sm');
            } else {
                navbar.classList.remove('bg-white/95', 'backdrop-blur-sm', 'shadow-sm');
            }
        });

        // 移动端菜单切换
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (menuToggle && mobileMenu) {
            menuToggle.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
        }
    </script>
</body>
</html> 